# OrbitTTSEdgeTTS

Асинхронный модуль преобразования текста в речь (TTS) с использованием [edge-tts](https://github.com/ranyelh/edge-tts) и воспроизведением через `sounddevice`.  
Поддерживает разбиение текста на чанки, удаление хвостовой тишины, параллельную генерацию и воспроизведение, а также корректную остановку. Изначально создавался для системы Orbit.

---

## Особенности

- Разбивает длинный текст на удобные для TTS части (чанки), сохраняя смысл предложений.
- Асинхронное производство аудиофайлов и параллельное воспроизведение с очередью.
- Обрезка хвостовой тишины, которая часто появляется у edge-tts.
- Возможность прервать воспроизведение в любой момент.
- Логирование с ротацией лог-файлов.
- Очистка временных файлов после работы.
- Поддержка выбора голосового движка Microsoft Neural TTS (voice parameter).
- Опциональный выбор аудиоустройства для воспроизведения.

---

## Установка

1. Убедитесь что у вас установлен Python версии 3.11 и библиотека guardin-mind
2. Установите майндер с помощью команды ```mind install esolment_OrbitTTSEdgeTTS```
3. Убедитесь, что у вас установлены библиотеки для работы со звуком (например, на Windows — драйверы, на Linux — ALSA или PulseAudio).
---

## Использование

```python
import asyncio
from guardin_mind import Mind

mind = Mind()
tts = mind.OrbitTTSEdgeTTS()

async def main():

    text = "Привет! Это пример работы нашего TTS модуля. Текст будет разбит на части и воспроизведён."

    # Запускаем воспроизведение
    success = await tts.speak(text, voice="ru-RU-SvetlanaNeural")

    if success:
        print("Воспроизведение завершено успешно.")
    else:
        print("Произошла ошибка при воспроизведении.")

    # Если нужно прервать воспроизведение
    # await tts.stop()

asyncio.run(main())
```

---

## Параметры метода `speak`

| Параметр           | Описание                                      | По умолчанию                                  |
| ------------------ | --------------------------------------------- | --------------------------------------------- |
| `user_text_to_tts` | Текст для озвучки                             | —                                             |
| `voice`            | Голос для edge-tts                            | `"ru-RU-SvetlanaNeural"`                      |
| `device_name`      | Имя или ID аудиоустройства для вывода         | `None` (используется устройство по умолчанию) |
| `max_queue_size`   | Максимальный размер очереди чанков            | `20`                                          |
| `tail_duration`    | Длина хвостовой тишины в секундах для обрезки | `0.7`                                         |

---

## Логирование

Логи пишутся в файл `orbit-temp/orbit-logs/orbit.log` с ротацией (максимум 1Мб на файл, 5 файлов бэкапов).
Логируются ошибки и основная информация о работе.

---

## Очистка временных файлов

Временные аудиофайлы хранятся в `orbit-temp/orbit-tts` и автоматически удаляются при запуске и после завершения воспроизведения.

---

## Ошибки и отладка

* Убедитесь, что `edge-tts` корректно установлена и работает в вашей системе.
* Проверьте, что аудиодрайверы и устройства корректно настроены.
* Логи помогут отследить возможные ошибки.
* Для остановки воспроизведения используйте метод `stop`.

---

## Лицензия

Этот проект распространяется под лицензией MIT.

---

## Контакты

Если возникли вопросы или предложения — пишите в issues или на email: [esolment@gmail.com](mailto:esolment@gmail.com)
